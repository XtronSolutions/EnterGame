{"version":3,"sources":["assets\\Script\\StorageManager.js"],"names":["GamePlayReferenceManager","StorageManager","cc","Class","name","Component","properties","Loader","type","Node","serializable","onLoad","active","anim","children","getComponent","Animation","play","CheckReferences","ReadData","onEnable","systemEvent","on","WriteData","RefreshData","ClearData","onDisable","off","require","userData","JSON","parse","sys","localStorage","getItem","server","Instance","Get_ServerBackend","console","log","GetUserData","data","SK","roleType","userToken","_data","setItem","stringify","_response","setTimeout","ReloginFromStorage","UIManag","Get_UIManager","ShowToast","removeItem"],"mappings":"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","sourceRoot":"/","sourcesContent":["var GamePlayReferenceManager=null;\r\n\r\nvar StorageManager = cc.Class({\r\n    name:\"StorageManager\",\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        Loader: {\r\n            default: null,        \r\n            type: cc.Node,\r\n            serializable: true,\r\n        },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad() {\r\n        GamePlayReferenceManager = null;\r\n        this.Loader.active = true;\r\n        var anim = this.Loader.children[0].children[1].getComponent(cc.Animation);\r\n        anim.play('loading');\r\n        \r\n        this.CheckReferences();\r\n        this.ReadData();\r\n    },\r\n\r\n    onEnable: function () {\r\n        //events subscription to be called \r\n        cc.systemEvent.on('WriteData', this.WriteData, this);\r\n        cc.systemEvent.on('RefreshData', this.RefreshData, this);\r\n        cc.systemEvent.on('ClearData', this.ClearData, this);\r\n      },\r\n    \r\n    onDisable: function () {\r\n        cc.systemEvent.off('WriteData', this.WriteData, this);\r\n        cc.systemEvent.on('RefreshData', this.RefreshData, this);\r\n        cc.systemEvent.on('ClearData', this.ClearData, this);\r\n      },\r\n\r\n\r\n    CheckReferences()\r\n    {\r\n        if(!GamePlayReferenceManager || GamePlayReferenceManager==null)\r\n            GamePlayReferenceManager=require('GamePlayReferenceManager');\r\n    },\r\n\r\n    ReadData()\r\n    {\r\n        var userData = JSON.parse(cc.sys.localStorage.getItem('userData'));\r\n        var server = GamePlayReferenceManager.Instance.Get_ServerBackend();\r\n        if (userData === null)\r\n        {\r\n            console.log(\"no session data found\");\r\n            this.Loader.active = false;\r\n        } else\r\n        {\r\n            //console.error(userData);\r\n            //check if token is expired or not\r\n            server.GetUserData(userData.data.SK,userData.data.roleType,userData.data.userToken,0);      \r\n        }\r\n    },\r\n\r\n    WriteData(_data)\r\n    {\r\n        cc.sys.localStorage.setItem('userData', JSON.stringify(_data));\r\n    },\r\n\r\n    RefreshData(_response)\r\n    {\r\n        if (_response == 0) { //means successful\r\n            var userData = JSON.parse(cc.sys.localStorage.getItem('userData'));\r\n            setTimeout(() => {\r\n                var server = GamePlayReferenceManager.Instance.Get_ServerBackend();\r\n                server.ReloginFromStorage(userData);\r\n            }, 500);\r\n\r\n            setTimeout(() => {\r\n                this.Loader.active = false;\r\n            }, 1200);\r\n        } else { //not successful\r\n            this.Loader.active = false;\r\n            var UIManag = GamePlayReferenceManager.Instance.Get_UIManager();\r\n            UIManag.ShowToast(\"session expires, please login again.\", 2400);\r\n        }\r\n    },\r\n    \r\n    ClearData()\r\n    {\r\n        cc.sys.localStorage.removeItem(\"userData\")\r\n    },\r\n});\r\n"]}