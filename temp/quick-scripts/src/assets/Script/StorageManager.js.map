{"version":3,"sources":["assets\\Script\\StorageManager.js"],"names":["GamePlayReferenceManager","IsWeb","StorageManager","cc","Class","name","Component","properties","Loader","type","Node","serializable","update","onLoad","console","log","error","warn","info","trace","active","anim","children","getComponent","Animation","play","CheckReferences","ReadData","onEnable","systemEvent","on","WriteData","RefreshData","ClearData","onDisable","off","require","userData","storedData","window","AllData","undefined","JSON","parse","sys","localStorage","getItem","server","Instance","Get_ServerBackend","GetUserData","SK","roleType","userToken","_data","stringify","setItem","_response","setTimeout","ReloginFromStorage","UIManag","Get_UIManager","ShowToast","removeItem"],"mappings":"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","sourceRoot":"/","sourcesContent":["var GamePlayReferenceManager = null;\r\n//for web make: IsWeb=true\r\n//for mobile make: IsWeb=false\r\nvar IsWeb = false;\r\nvar StorageManager = cc.Class({\r\n  name: \"StorageManager\",\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n    Loader: {\r\n      default: null,\r\n      type: cc.Node,\r\n      serializable: true,\r\n    },\r\n  },\r\n\r\n  // LIFE-CYCLE CALLBACKS:\r\n\r\n  update() {\r\n    // if (cc.sys.getNetworkType() == cc.sys.NetworkType.LAN || cc.sys.getNetworkType() == cc.sys.NetworkType.WWAN) {\r\n    //   console.log(\"connected\");\r\n    // } else if (cc.sys.getNetworkType() == cc.sys.NetworkType.NONE) {\r\n    //   console.log(\"not connected\");\r\n    // }\r\n  },\r\n  onLoad() {\r\n    console.log(\"V15\");\r\n    if(IsWeb)\r\n    {\r\n      console.log = function () {};\r\n      console.error = function () {};\r\n      console.warn = function () {};\r\n      console.info = function () {};\r\n      console.trace = function () {};\r\n    }\r\n    GamePlayReferenceManager = null;\r\n    this.Loader.active = true;\r\n    var anim = this.Loader.children[0].children[1].getComponent(cc.Animation);\r\n    anim.play(\"loading\");\r\n\r\n    this.CheckReferences();\r\n    this.ReadData();\r\n  },\r\n\r\n  onEnable: function () {\r\n    //events subscription to be called\r\n    cc.systemEvent.on(\"WriteData\", this.WriteData, this);\r\n    cc.systemEvent.on(\"RefreshData\", this.RefreshData, this);\r\n    cc.systemEvent.on(\"ClearData\", this.ClearData, this);\r\n  },\r\n\r\n  onDisable: function () {\r\n    cc.systemEvent.off(\"WriteData\", this.WriteData, this);\r\n    cc.systemEvent.off(\"RefreshData\", this.RefreshData, this);\r\n    cc.systemEvent.off(\"ClearData\", this.ClearData, this);\r\n  },\r\n\r\n  CheckReferences() {\r\n    if (!GamePlayReferenceManager || GamePlayReferenceManager == null) GamePlayReferenceManager = require(\"GamePlayReferenceManager\");\r\n  },\r\n\r\n  ReadData() {\r\n    var userData;\r\n    if (IsWeb) {\r\n      var storedData = window.AllData;\r\n      console.log(storedData);\r\n      if (storedData == undefined || storedData == null) {\r\n        userData = null;\r\n      } else {\r\n        userData = JSON.parse(storedData);\r\n      }\r\n    } else {\r\n      userData = JSON.parse(cc.sys.localStorage.getItem(\"userData\"));\r\n    }\r\n    var server = GamePlayReferenceManager.Instance.Get_ServerBackend();\r\n    if (userData === null) {\r\n      console.log(\"no session data found\");\r\n      this.Loader.active = false;\r\n    } else {\r\n      //check if token is expired or not\r\n      server.GetUserData(userData.SK, userData.roleType, userData.userToken, 0);\r\n    }\r\n  },\r\n\r\n  WriteData(_data) {\r\n    if (IsWeb) {\r\n      window.AllData = JSON.stringify(_data);\r\n    } else {\r\n      cc.sys.localStorage.setItem(\"userData\", JSON.stringify(_data));\r\n    }\r\n  },\r\n\r\n  RefreshData(_response) {\r\n    if (_response == 0) {\r\n      //means successful\r\n      var userData;\r\n      if (IsWeb) {\r\n        userData = JSON.parse(window.AllData);\r\n      } else {\r\n        userData = JSON.parse(cc.sys.localStorage.getItem(\"userData\"));\r\n      }\r\n      setTimeout(() => {\r\n        var server = GamePlayReferenceManager.Instance.Get_ServerBackend();\r\n        server.ReloginFromStorage(userData);\r\n      }, 500);\r\n\r\n      setTimeout(() => {\r\n        this.Loader.active = false;\r\n      }, 1200);\r\n    } else {\r\n      //not successful\r\n      this.Loader.active = false;\r\n      var UIManag = GamePlayReferenceManager.Instance.Get_UIManager();\r\n      UIManag.ShowToast(\"session expires, please login again.\", 2400);\r\n    }\r\n  },\r\n\r\n  ClearData() {\r\n    if (IsWeb) {\r\n      window.AllData = null;\r\n    } else {\r\n      cc.sys.localStorage.removeItem(\"userData\");\r\n    }\r\n  },\r\n});\r\n"]}