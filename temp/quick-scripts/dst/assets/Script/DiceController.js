
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/DiceController.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '23d62/RS6BCHLlnlqi2id9x', 'DiceController');
// Script/DiceController.js

"use strict";

var GamePlayReferenceManager = null;
var DiceData = cc.Class({
  name: "DiceData",
  properties: {
    BGSprite: {
      "default": null,
      type: cc.Sprite,
      serializable: true
    },
    DiceNodes: {
      "default": [],
      type: [cc.Node],
      serializable: true
    }
  },
  ctor: function ctor() {//constructor//
  }
});
var DiceController = cc.Class({
  name: "DiceController",
  "extends": cc.Component,
  properties: {
    HasOneDice: {
      "default": false,
      type: cc.Boolean,
      serializable: true
    },
    HasTwoDices: {
      "default": false,
      type: cc.Boolean,
      serializable: true
    },
    DiceOneData: {
      "default": {},
      type: DiceData,
      serializable: true
    },
    DiceTwoData: {
      "default": {},
      type: DiceData,
      serializable: true
    }
  },
  statics: {
    Instance: null
  },
  CheckReferences: function CheckReferences() {
    if (!GamePlayReferenceManager || GamePlayReferenceManager == null) GamePlayReferenceManager = require('GamePlayReferenceManager');
  },
  ClearAllTimeouts: function ClearAllTimeouts() {
    clearTimeout();
  },
  onEnable: function onEnable() {
    DiceController.Instance = this;
    this.CheckReferences();
    this.ResetDice();
    this.DiceCounter = 0;
    this.MaxCounter = this.getRandom(12, 21);
    this.DiceSpeed = 150; //this.AnimateDice(4,5);
  },
  start: function start() {},
  IterateDice: function IterateDice(_dice, _index) {
    for (var index = 0; index < _dice.length; index++) {
      if (_index == index) _dice[index].active = true;else _dice[index].active = false;
    }
  },
  AnimateDice: function AnimateDice(_dice1Value, _dice2Value) {
    var _this = this;

    if (_dice1Value === void 0) {
      _dice1Value = 0;
    }

    if (_dice2Value === void 0) {
      _dice2Value = 0;
    }

    try {
      if (this.DiceCounter < this.MaxCounter) {
        if (this.HasOneDice) {
          if (this.DiceOneData) {
            var _displayIndex = this.getRandom(0, 6);

            this.IterateDice(this.DiceOneData.DiceNodes, _displayIndex);
          }
        }

        if (this.HasTwoDices) {
          if (this.DiceTwoData) {
            var _displayIndex2 = this.getRandom(0, 6);

            this.IterateDice(this.DiceTwoData.DiceNodes, _displayIndex2);
          }
        }

        setTimeout(function () {
          _this.DiceCounter++;

          _this.AnimateDice(_dice1Value, _dice2Value);
        }, this.DiceSpeed);
      } else {
        this.DiceCounter = 0;

        if (this.DiceOneData && this.DiceTwoData) {
          if (this.HasOneDice) this.IterateDice(this.DiceOneData.DiceNodes, _dice1Value - 1);
          if (this.HasTwoDices) this.IterateDice(this.DiceTwoData.DiceNodes, _dice2Value - 1);
        }

        setTimeout(function () {
          if (GamePlayReferenceManager.Instance.Get_GameManager()) {
            GamePlayReferenceManager.Instance.Get_GameManager().DiceFuntionality();
          }
        }, 1000);
      }
    } catch (error) {}
  },
  getRandom: function getRandom(min, max) {
    return Math.floor(Math.random() * (max - min)) + min; // min included and max excluded
  },
  ResetDice: function ResetDice() {
    if (this.DiceOneData && this.DiceTwoData) {
      this.IterateDice(this.DiceOneData.DiceNodes, 0);
      this.IterateDice(this.DiceTwoData.DiceNodes, 0);
    }
  }
});
module.exports = DiceController;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxEaWNlQ29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJHYW1lUGxheVJlZmVyZW5jZU1hbmFnZXIiLCJEaWNlRGF0YSIsImNjIiwiQ2xhc3MiLCJuYW1lIiwicHJvcGVydGllcyIsIkJHU3ByaXRlIiwidHlwZSIsIlNwcml0ZSIsInNlcmlhbGl6YWJsZSIsIkRpY2VOb2RlcyIsIk5vZGUiLCJjdG9yIiwiRGljZUNvbnRyb2xsZXIiLCJDb21wb25lbnQiLCJIYXNPbmVEaWNlIiwiQm9vbGVhbiIsIkhhc1R3b0RpY2VzIiwiRGljZU9uZURhdGEiLCJEaWNlVHdvRGF0YSIsInN0YXRpY3MiLCJJbnN0YW5jZSIsIkNoZWNrUmVmZXJlbmNlcyIsInJlcXVpcmUiLCJDbGVhckFsbFRpbWVvdXRzIiwiY2xlYXJUaW1lb3V0Iiwib25FbmFibGUiLCJSZXNldERpY2UiLCJEaWNlQ291bnRlciIsIk1heENvdW50ZXIiLCJnZXRSYW5kb20iLCJEaWNlU3BlZWQiLCJzdGFydCIsIkl0ZXJhdGVEaWNlIiwiX2RpY2UiLCJfaW5kZXgiLCJpbmRleCIsImxlbmd0aCIsImFjdGl2ZSIsIkFuaW1hdGVEaWNlIiwiX2RpY2UxVmFsdWUiLCJfZGljZTJWYWx1ZSIsIl9kaXNwbGF5SW5kZXgiLCJfZGlzcGxheUluZGV4MiIsInNldFRpbWVvdXQiLCJHZXRfR2FtZU1hbmFnZXIiLCJEaWNlRnVudGlvbmFsaXR5IiwiZXJyb3IiLCJtaW4iLCJtYXgiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUlBLHdCQUF3QixHQUFDLElBQTdCO0FBQ0EsSUFBSUMsUUFBUSxHQUFDQyxFQUFFLENBQUNDLEtBQUgsQ0FBUztBQUNsQkMsRUFBQUEsSUFBSSxFQUFDLFVBRGE7QUFFbEJDLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxRQUFRLEVBQUU7QUFDTixpQkFBUyxJ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a0N3QixlQUFsQyxFQUFILEVBQ0E7QUFDQzdDLFlBQUFBLHdCQUF3QixDQUFDcUIsUUFBekIsQ0FBa0N3QixlQUFsQyxHQUFvREMsZ0JBQXBEO0FBQ0E7QUFDSixTQUxTLEVBS1AsSUFMTyxDQUFWO0FBTUY7QUFDSixLQTlDRCxDQThDRSxPQUFPQyxLQUFQLEVBQWMsQ0FFZjtBQUVKLEdBdkh1QjtBQXlIeEJqQixFQUFBQSxTQUFTLEVBQUMsbUJBQVNrQixHQUFULEVBQWFDLEdBQWIsRUFDVjtBQUNJLFdBQU9DLElBQUksQ0FBQ0MsS0FBTCxDQUFXRCxJQUFJLENBQUNFLE1BQUwsTUFBaUJILEdBQUcsR0FBR0QsR0FBdkIsQ0FBWCxJQUEyQ0EsR0FBbEQsQ0FESixDQUMyRDtBQUMxRCxHQTVIdUI7QUE4SHhCckIsRUFBQUEsU0E5SHdCLHVCQStIeEI7QUFDSSxRQUFHLEtBQUtULFdBQUwsSUFBb0IsS0FBS0MsV0FBNUIsRUFDQTtBQUNBLFdBQUtjLFdBQUwsQ0FBaUIsS0FBS2YsV0FBTCxDQUFpQlIsU0FBbEMsRUFBNEMsQ0FBNUM7QUFDQSxXQUFLdUIsV0FBTCxDQUFpQixLQUFLZCxXQUFMLENBQWlCVCxTQUFsQyxFQUE0QyxDQUE1QztBQUNDO0FBQ0o7QUFySXVCLENBQVQsQ0FBbkI7QUF3SUEyQyxNQUFNLENBQUNDLE9BQVAsR0FBaUJ6QyxjQUFqQiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsidmFyIEdhbWVQbGF5UmVmZXJlbmNlTWFuYWdlcj1udWxsO1xyXG52YXIgRGljZURhdGE9Y2MuQ2xhc3Moe1xyXG4gICAgbmFtZTpcIkRpY2VEYXRhXCIsXHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgQkdTcHJpdGU6IHtcclxuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcclxuICAgICAgICAgICAgdHlwZTogY2MuU3ByaXRlLFxyXG4gICAgICAgICAgICBzZXJpYWxpemFibGU6IHRydWUsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBEaWNlTm9kZXM6IHtcclxuICAgICAgICAgICAgZGVmYXVsdDogW10sXHJcbiAgICAgICAgICAgIHR5cGU6IFtjYy5Ob2RlXSxcclxuICAgICAgICAgICAgc2VyaWFsaXphYmxlOiB0cnVlLFxyXG4gICAgICAgIH0sXHJcbiAgICB9LFxyXG5cclxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHsvL2NvbnN0cnVjdG9yLy9cclxuICAgIH0sXHJcbn0pO1xyXG52YXIgRGljZUNvbnRyb2xsZXI9Y2MuQ2xhc3Moe1xyXG4gICAgbmFtZTpcIkRpY2VDb250cm9sbGVyXCIsXHJcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXHJcblxyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIEhhc09uZURpY2U6IHtcclxuICAgICAgICAgICAgZGVmYXVsdDogZmFsc2UsXHJcbiAgICAgICAgICAgIHR5cGU6IGNjLkJvb2xlYW4sXHJcbiAgICAgICAgICAgIHNlcmlhbGl6YWJsZTogdHJ1ZSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIEhhc1R3b0RpY2VzOiB7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IGZhbHNlLFxyXG4gICAgICAgICAgICB0eXBlOiBjYy5Cb29sZWFuLFxyXG4gICAgICAgICAgICBzZXJpYWxpemFibGU6IHRydWUsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBEaWNlT25lRGF0YToge1xyXG4gICAgICAgICAgICBkZWZhdWx0OiB7fSxcclxuICAgICAgICAgICAgdHlwZTogRGljZURhdGEsXHJcbiAgICAgICAgICAgIHNlcmlhbGl6YWJsZTogdHJ1ZSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIERpY2VUd29EYXRhOiB7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IHt9LFxyXG4gICAgICAgICAgICB0eXBlOiBEaWNlRGF0YSxcclxuICAgICAgICAgICAgc2VyaWFsaXphYmxlOiB0cnVlLFxyXG4gICAgICAgIH0sXHJcbiAgICB9LFxyXG4gICAgc3RhdGljczoge1xyXG4gICAgICAgIEluc3RhbmNlOiBudWxsLFxyXG4gICAgICB9LFxyXG4gICAgXHJcblxyXG4gICAgQ2hlY2tSZWZlcmVuY2VzKClcclxuICAgIHtcclxuICAgICAgICBpZighR2FtZVBsYXlSZWZlcmVuY2VNYW5hZ2VyIHx8IEdhbWVQbGF5UmVmZXJlbmNlTWFuYWdlcj09bnVsbClcclxuICAgICAgICBHYW1lUGxheVJlZmVyZW5jZU1hbmFnZXI9cmVxdWlyZSgnR2FtZVBsYXlSZWZlcmVuY2VNYW5hZ2VyJyk7XHJcbiAgICB9LFxyXG5cclxuICAgIENsZWFyQWxsVGltZW91dHMoKVxyXG4gICAge1xyXG4gICAgICAgIGNsZWFyVGltZW91dCgpO1xyXG4gICAgfSxcclxuXHJcbiAgICBvbkVuYWJsZSgpXHJcbiAgICB7XHJcbiAgICAgICAgRGljZUNvbnRyb2xsZXIuSW5zdGFuY2U9dGhpcztcclxuICAgICAgICB0aGlzLkNoZWNrUmVmZXJlbmNlcygpO1xyXG4gICAgICAgIHRoaXMuUmVzZXREaWNlKCk7XHJcbiAgICAgICAgdGhpcy5EaWNlQ291bnRlcj0wO1xyXG4gICAgICAgIHRoaXMuTWF4Q291bnRlcj10aGlzLmdldFJhbmRvbSgxMiwyMSk7XHJcbiAgICAgICAgdGhpcy5EaWNlU3BlZWQ9MTUwO1xyXG4gICAgICAgIC8vdGhpcy5BbmltYXRlRGljZSg0LDUpO1xyXG4gICAgfSxcclxuXHJcbiAgICBzdGFydCAoKSB7XHJcblxyXG4gICAgfSxcclxuXHJcbiAgICBJdGVyYXRlRGljZShfZGljZSxfaW5kZXgpXHJcbiAgICB7XHJcbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IF9kaWNlLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICAgICAgICBpZihfaW5kZXg9PWluZGV4KVxyXG4gICAgICAgICAgICAgICAgX2RpY2VbaW5kZXhdLmFjdGl2ZT10cnVlO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBfZGljZVtpbmRleF0uYWN0aXZlPWZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgQW5pbWF0ZURpY2UoX2RpY2UxVmFsdWU9MCxfZGljZTJWYWx1ZT0wKVxyXG4gICAge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuRGljZUNvdW50ZXI8dGhpcy5NYXhDb3VudGVyKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLkhhc09uZURpY2UpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5EaWNlT25lRGF0YSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfZGlzcGxheUluZGV4PXRoaXMuZ2V0UmFuZG9tKDAsNilcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5JdGVyYXRlRGljZSh0aGlzLkRpY2VPbmVEYXRhLkRpY2VOb2RlcyxfZGlzcGxheUluZGV4KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuSGFzVHdvRGljZXMpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5EaWNlVHdvRGF0YSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfZGlzcGxheUluZGV4Mj10aGlzLmdldFJhbmRvbSgwLDYpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuSXRlcmF0ZURpY2UodGhpcy5EaWNlVHdvRGF0YS5EaWNlTm9kZXMsX2Rpc3BsYXlJbmRleDIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5EaWNlQ291bnRlcisrO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuQW5pbWF0ZURpY2UoX2RpY2UxVmFsdWUsX2RpY2UyVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgIH0sdGhpcy5EaWNlU3BlZWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5EaWNlQ291bnRlcj0wO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLkRpY2VPbmVEYXRhICYmIHRoaXMuRGljZVR3b0RhdGEpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLkhhc09uZURpY2UpXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5JdGVyYXRlRGljZSh0aGlzLkRpY2VPbmVEYXRhLkRpY2VOb2RlcywoX2RpY2UxVmFsdWUtMSkpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLkhhc1R3b0RpY2VzKVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuSXRlcmF0ZURpY2UodGhpcy5EaWNlVHdvRGF0YS5EaWNlTm9kZXMsKF9kaWNlMlZhbHVlLTEpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICBpZihHYW1lUGxheVJlZmVyZW5jZU1hbmFnZXIuSW5zdGFuY2UuR2V0X0dhbWVNYW5hZ2VyKCkpXHJcbiAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgR2FtZVBsYXlSZWZlcmVuY2VNYW5hZ2VyLkluc3RhbmNlLkdldF9HYW1lTWFuYWdlcigpLkRpY2VGdW50aW9uYWxpdHkoKTtcclxuICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgfSwgMTAwMCk7IFxyXG4gICAgICAgICAgICB9ICAgXHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG4gICAgICAgXHJcbiAgICB9LFxyXG5cclxuICAgIGdldFJhbmRvbTpmdW5jdGlvbihtaW4sbWF4KVxyXG4gICAge1xyXG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluKSApICsgbWluOyAvLyBtaW4gaW5jbHVkZWQgYW5kIG1heCBleGNsdWRlZFxyXG4gICAgfSxcclxuXHJcbiAgICBSZXNldERpY2UoKVxyXG4gICAge1xyXG4gICAgICAgIGlmKHRoaXMuRGljZU9uZURhdGEgJiYgdGhpcy5EaWNlVHdvRGF0YSlcclxuICAgICAgICB7XHJcbiAgICAgICAgdGhpcy5JdGVyYXRlRGljZSh0aGlzLkRpY2VPbmVEYXRhLkRpY2VOb2RlcywwKTtcclxuICAgICAgICB0aGlzLkl0ZXJhdGVEaWNlKHRoaXMuRGljZVR3b0RhdGEuRGljZU5vZGVzLDApO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbn0pO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBEaWNlQ29udHJvbGxlcjtcclxuIl19