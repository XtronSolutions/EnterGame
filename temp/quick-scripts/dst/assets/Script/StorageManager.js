
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/StorageManager.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'f5a14bMsD9JSZovKg9aBEdQ', 'StorageManager');
// Script/StorageManager.js

"use strict";

var GamePlayReferenceManager = null;
var IsWeb = true;
var StorageManager = cc.Class({
  name: "StorageManager",
  "extends": cc.Component,
  properties: {
    Loader: {
      "default": null,
      type: cc.Node,
      serializable: true
    }
  },
  // LIFE-CYCLE CALLBACKS:
  onLoad: function onLoad() {
    console.log("V10"); // console.log = function () {};
    //  console.error = function () {};
    // console.warn = function () {};

    GamePlayReferenceManager = null;
    this.Loader.active = true;
    var anim = this.Loader.children[0].children[1].getComponent(cc.Animation);
    anim.play("loading");
    this.CheckReferences();
    this.ReadData();
  },
  onEnable: function onEnable() {
    //events subscription to be called
    cc.systemEvent.on("WriteData", this.WriteData, this);
    cc.systemEvent.on("RefreshData", this.RefreshData, this);
    cc.systemEvent.on("ClearData", this.ClearData, this);
  },
  onDisable: function onDisable() {
    cc.systemEvent.off("WriteData", this.WriteData, this);
    cc.systemEvent.off("RefreshData", this.RefreshData, this);
    cc.systemEvent.off("ClearData", this.ClearData, this);
  },
  CheckReferences: function CheckReferences() {
    if (!GamePlayReferenceManager || GamePlayReferenceManager == null) GamePlayReferenceManager = require("GamePlayReferenceManager");
  },
  ReadData: function ReadData() {
    var userData;

    if (IsWeb) {
      var storedData = window.AllData;
      console.log(storedData);

      if (storedData == undefined || storedData == null) {
        userData = null;
      } else {
        userData = JSON.parse(storedData);
      }
    } else {
      userData = JSON.parse(cc.sys.localStorage.getItem("userData"));
    }

    var server = GamePlayReferenceManager.Instance.Get_ServerBackend();

    if (userData === null) {
      console.log("no session data found");
      this.Loader.active = false;
    } else {
      //check if token is expired or not
      server.GetUserData(userData.SK, userData.roleType, userData.userToken, 0);
    }
  },
  WriteData: function WriteData(_data) {
    if (IsWeb) {
      window.AllData = JSON.stringify(_data);
    } else {
      cc.sys.localStorage.setItem("userData", JSON.stringify(_data));
    }
  },
  RefreshData: function RefreshData(_response) {
    var _this = this;

    if (_response == 0) {
      //means successful
      var userData;

      if (IsWeb) {
        userData = JSON.parse(window.AllData);
      } else {
        userData = JSON.parse(cc.sys.localStorage.getItem("userData"));
      }

      setTimeout(function () {
        var server = GamePlayReferenceManager.Instance.Get_ServerBackend();
        server.ReloginFromStorage(userData);
      }, 500);
      setTimeout(function () {
        _this.Loader.active = false;
      }, 1200);
    } else {
      //not successful
      this.Loader.active = false;
      var UIManag = GamePlayReferenceManager.Instance.Get_UIManager();
      UIManag.ShowToast("session expires, please login again.", 2400);
    }
  },
  ClearData: function ClearData() {
    if (IsWeb) {
      window.AllData = null;
    } else {
      cc.sys.localStorage.removeItem("userData");
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxTdG9yYWdlTWFuYWdlci5qcyJdLCJuYW1lcyI6WyJHYW1lUGxheVJlZmVyZW5jZU1hbmFnZXIiLCJJc1dlYiIsIlN0b3JhZ2VNYW5hZ2VyIiwiY2MiLCJDbGFzcyIsIm5hbWUiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwiTG9hZGVyIiwidHlwZSIsIk5vZGUiLCJzZXJpYWxpemFibGUiLCJvbkxvYWQiLCJjb25zb2xlIiwibG9nIiwiYWN0aXZlIiwiYW5pbSIsImNoaWxkcmVuIiwiZ2V0Q29tcG9uZW50IiwiQW5pbWF0aW9uIiwicGxheSIsIkNoZWNrUmVmZXJlbmNlcyIsIlJlYWREYXRhIiwib25FbmFibGUiLCJzeXN0ZW1FdmVudCIsIm9uIiwiV3JpdGVEYXRhIiwiUmVmcmVzaERhdGEiLCJDbGVhckRhdGEiLCJvbkRpc2FibGUiLCJvZmYiLCJyZXF1aXJlIiwidXNlckRhdGEiLCJzdG9yZWREYXRhIiwid2luZG93IiwiQWxsRGF0YSIsInVuZGVmaW5lZCIsIkpTT04iLCJwYXJzZSIsInN5cyIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzZXJ2ZXIiLCJJbnN0YW5jZSIsIkdldF9TZXJ2ZXJCYWNrZW5kIiwiR2V0VXNlckRhdGEiLCJTSyIsInJvbGVUeXBlIiwidXNlclRva2VuIiwiX2RhdGEiLCJzdHJpbmdpZnkiLCJzZXRJdGVtIiwiX3Jlc3BvbnNlIiwic2V0VGltZW91dCIsIlJlbG9naW5Gcm9tU3RvcmFnZSIsIlVJTWFuYWciLCJHZXRfVUlNYW5hZ2VyIiwiU2hvd1RvYXN0IiwicmVtb3ZlSXRlbSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSx3QkFBd0IsR0FBRyxJQUEvQjtBQUNBLElBQUlDLEtBQUssR0FBRyxJQUFaO0FBQ0EsSUFBSUMsY0FBYyxHQUFHQyxFQUFFLENBQUNDLEtBQUgsQ0FBUztBQUM1QkMsRUFBQUEsSUFBSSxFQUFFLGdCQURzQjtBQUU1QixhQUFTRixFQUFF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LFFBQUFBLE1BQU0sQ0FBQ1ksa0JBQVAsQ0FBMEJ0QixRQUExQjtBQUNELE9BSFMsRUFHUCxHQUhPLENBQVY7QUFLQXFCLE1BQUFBLFVBQVUsQ0FBQyxZQUFNO0FBQ2YsUUFBQSxLQUFJLENBQUM3QyxNQUFMLENBQVlPLE1BQVosR0FBcUIsS0FBckI7QUFDRCxPQUZTLEVBRVAsSUFGTyxDQUFWO0FBR0QsS0FoQkQsTUFnQk87QUFDTDtBQUNBLFdBQUtQLE1BQUwsQ0FBWU8sTUFBWixHQUFxQixLQUFyQjtBQUNBLFVBQUl3QyxPQUFPLEdBQUd2RCx3QkFBd0IsQ0FBQzJDLFFBQXpCLENBQWtDYSxhQUFsQyxFQUFkO0FBQ0FELE1BQUFBLE9BQU8sQ0FBQ0UsU0FBUixDQUFrQixzQ0FBbEIsRUFBMEQsSUFBMUQ7QUFDRDtBQUNGLEdBbkcyQjtBQXFHNUI3QixFQUFBQSxTQXJHNEIsdUJBcUdoQjtBQUNWLFFBQUkzQixLQUFKLEVBQVc7QUFDVGlDLE1BQUFBLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQixJQUFqQjtBQUNELEtBRkQsTUFFTztBQUNMaEMsTUFBQUEsRUFBRSxDQUFDb0MsR0FBSCxDQUFPQyxZQUFQLENBQW9Ca0IsVUFBcEIsQ0FBK0IsVUFBL0I7QUFDRDtBQUNGO0FBM0cyQixDQUFULENBQXJCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgR2FtZVBsYXlSZWZlcmVuY2VNYW5hZ2VyID0gbnVsbDtcclxudmFyIElzV2ViID0gdHJ1ZTtcclxudmFyIFN0b3JhZ2VNYW5hZ2VyID0gY2MuQ2xhc3Moe1xyXG4gIG5hbWU6IFwiU3RvcmFnZU1hbmFnZXJcIixcclxuICBleHRlbmRzOiBjYy5Db21wb25lbnQsXHJcblxyXG4gIHByb3BlcnRpZXM6IHtcclxuICAgIExvYWRlcjoge1xyXG4gICAgICBkZWZhdWx0OiBudWxsLFxyXG4gICAgICB0eXBlOiBjYy5Ob2RlLFxyXG4gICAgICBzZXJpYWxpemFibGU6IHRydWUsXHJcbiAgICB9LFxyXG4gIH0sXHJcblxyXG4gIC8vIExJRkUtQ1lDTEUgQ0FMTEJBQ0tTOlxyXG5cclxuICBvbkxvYWQoKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcIlYxMFwiKTtcclxuICAgIC8vIGNvbnNvbGUubG9nID0gZnVuY3Rpb24gKCkge307XHJcbiAgICAvLyAgY29uc29sZS5lcnJvciA9IGZ1bmN0aW9uICgpIHt9O1xyXG4gICAgLy8gY29uc29sZS53YXJuID0gZnVuY3Rpb24gKCkge307XHJcbiAgICBHYW1lUGxheVJlZmVyZW5jZU1hbmFnZXIgPSBudWxsO1xyXG4gICAgdGhpcy5Mb2FkZXIuYWN0aXZlID0gdHJ1ZTtcclxuICAgIHZhciBhbmltID0gdGhpcy5Mb2FkZXIuY2hpbGRyZW5bMF0uY2hpbGRyZW5bMV0uZ2V0Q29tcG9uZW50KGNjLkFuaW1hdGlvbik7XHJcbiAgICBhbmltLnBsYXkoXCJsb2FkaW5nXCIpO1xyXG5cclxuICAgIHRoaXMuQ2hlY2tSZWZlcmVuY2VzKCk7XHJcbiAgICB0aGlzLlJlYWREYXRhKCk7XHJcbiAgfSxcclxuXHJcbiAgb25FbmFibGU6IGZ1bmN0aW9uICgpIHtcclxuICAgIC8vZXZlbnRzIHN1YnNjcmlwdGlvbiB0byBiZSBjYWxsZWRcclxuICAgIGNjLnN5c3RlbUV2ZW50Lm9uKFwiV3JpdGVEYXRhXCIsIHRoaXMuV3JpdGVEYXRhLCB0aGlzKTtcclxuICAgIGNjLnN5c3RlbUV2ZW50Lm9uKFwiUmVmcmVzaERhdGFcIiwgdGhpcy5SZWZyZXNoRGF0YSwgdGhpcyk7XHJcbiAgICBjYy5zeXN0ZW1FdmVudC5vbihcIkNsZWFyRGF0YVwiLCB0aGlzLkNsZWFyRGF0YSwgdGhpcyk7XHJcbiAgfSxcclxuXHJcbiAgb25EaXNhYmxlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICBjYy5zeXN0ZW1FdmVudC5vZmYoXCJXcml0ZURhdGFcIiwgdGhpcy5Xcml0ZURhdGEsIHRoaXMpO1xyXG4gICAgY2Muc3lzdGVtRXZlbnQub2ZmKFwiUmVmcmVzaERhdGFcIiwgdGhpcy5SZWZyZXNoRGF0YSwgdGhpcyk7XHJcbiAgICBjYy5zeXN0ZW1FdmVudC5vZmYoXCJDbGVhckRhdGFcIiwgdGhpcy5DbGVhckRhdGEsIHRoaXMpO1xyXG4gIH0sXHJcblxyXG4gIENoZWNrUmVmZXJlbmNlcygpIHtcclxuICAgIGlmICghR2FtZVBsYXlSZWZlcmVuY2VNYW5hZ2VyIHx8IEdhbWVQbGF5UmVmZXJlbmNlTWFuYWdlciA9PSBudWxsKSBHYW1lUGxheVJlZmVyZW5jZU1hbmFnZXIgPSByZXF1aXJlKFwiR2FtZVBsYXlSZWZlcmVuY2VNYW5hZ2VyXCIpO1xyXG4gIH0sXHJcblxyXG4gIFJlYWREYXRhKCkge1xyXG4gICAgdmFyIHVzZXJEYXRhO1xyXG4gICAgaWYgKElzV2ViKSB7XHJcbiAgICAgIHZhciBzdG9yZWREYXRhID0gd2luZG93LkFsbERhdGE7XHJcbiAgICAgIGNvbnNvbGUubG9nKHN0b3JlZERhdGEpO1xyXG4gICAgICBpZiAoc3RvcmVkRGF0YSA9PSB1bmRlZmluZWQgfHwgc3RvcmVkRGF0YSA9PSBudWxsKSB7XHJcbiAgICAgICAgdXNlckRhdGEgPSBudWxsO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHVzZXJEYXRhID0gSlNPTi5wYXJzZShzdG9yZWREYXRhKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdXNlckRhdGEgPSBKU09OLnBhcnNlKGNjLnN5cy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInVzZXJEYXRhXCIpKTtcclxuICAgIH1cclxuICAgIHZhciBzZXJ2ZXIgPSBHYW1lUGxheVJlZmVyZW5jZU1hbmFnZXIuSW5zdGFuY2UuR2V0X1NlcnZlckJhY2tlbmQoKTtcclxuICAgIGlmICh1c2VyRGF0YSA9PT0gbnVsbCkge1xyXG4gICAgICBjb25zb2xlLmxvZyhcIm5vIHNlc3Npb24gZGF0YSBmb3VuZFwiKTtcclxuICAgICAgdGhpcy5Mb2FkZXIuYWN0aXZlID0gZmFsc2U7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvL2NoZWNrIGlmIHRva2VuIGlzIGV4cGlyZWQgb3Igbm90XHJcbiAgICAgIHNlcnZlci5HZXRVc2VyRGF0YSh1c2VyRGF0YS5TSywgdXNlckRhdGEucm9sZVR5cGUsIHVzZXJEYXRhLnVzZXJUb2tlbiwgMCk7XHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgV3JpdGVEYXRhKF9kYXRhKSB7XHJcbiAgICBpZiAoSXNXZWIpIHtcclxuICAgICAgd2luZG93LkFsbERhdGEgPSBKU09OLnN0cmluZ2lmeShfZGF0YSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjYy5zeXMubG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJ1c2VyRGF0YVwiLCBKU09OLnN0cmluZ2lmeShfZGF0YSkpO1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIFJlZnJlc2hEYXRhKF9yZXNwb25zZSkge1xyXG4gICAgaWYgKF9yZXNwb25zZSA9PSAwKSB7XHJcbiAgICAgIC8vbWVhbnMgc3VjY2Vzc2Z1bFxyXG4gICAgICB2YXIgdXNlckRhdGE7XHJcbiAgICAgIGlmIChJc1dlYikge1xyXG4gICAgICAgIHVzZXJEYXRhID0gSlNPTi5wYXJzZSh3aW5kb3cuQWxsRGF0YSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdXNlckRhdGEgPSBKU09OLnBhcnNlKGNjLnN5cy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInVzZXJEYXRhXCIpKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB2YXIgc2VydmVyID0gR2FtZVBsYXlSZWZlcmVuY2VNYW5hZ2VyLkluc3RhbmNlLkdldF9TZXJ2ZXJCYWNrZW5kKCk7XHJcbiAgICAgICAgc2VydmVyLlJlbG9naW5Gcm9tU3RvcmFnZSh1c2VyRGF0YSk7XHJcbiAgICAgIH0sIDUwMCk7XHJcblxyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB0aGlzLkxvYWRlci5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgfSwgMTIwMCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvL25vdCBzdWNjZXNzZnVsXHJcbiAgICAgIHRoaXMuTG9hZGVyLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICB2YXIgVUlNYW5hZyA9IEdhbWVQbGF5UmVmZXJlbmNlTWFuYWdlci5JbnN0YW5jZS5HZXRfVUlNYW5hZ2VyKCk7XHJcbiAgICAgIFVJTWFuYWcuU2hvd1RvYXN0KFwic2Vzc2lvbiBleHBpcmVzLCBwbGVhc2UgbG9naW4gYWdhaW4uXCIsIDI0MDApO1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIENsZWFyRGF0YSgpIHtcclxuICAgIGlmIChJc1dlYikge1xyXG4gICAgICB3aW5kb3cuQWxsRGF0YSA9IG51bGw7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjYy5zeXMubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJ1c2VyRGF0YVwiKTtcclxuICAgIH1cclxuICB9LFxyXG59KTtcclxuIl19